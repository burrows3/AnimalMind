<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <title>Animal Research Network</title>
  <meta name="description" content="Surveillance, literature, clinical, and vet practice resources for animal health. Read-only research interface. No credentials or PII exposed.">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
      background: #fafbfc;
      color: #1f2937;
      min-height: 100vh;
      line-height: 1.6;
    }
    .page { max-width: 64rem; margin: 0 auto; padding: 2rem 1.5rem; }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid #e5e7eb;
      margin-bottom: 2rem;
    }
    .logo { font-weight: 600; font-size: 1.25rem; color: #111827; }
    .badge { font-size: 0.7rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: #059669; background: #ecfdf5; padding: 0.35rem 0.65rem; border-radius: 6px; }
    .hero { text-align: center; padding: 2rem 0 1.5rem; }
    .hero h1 { font-size: clamp(1.75rem, 4vw, 2.25rem); font-weight: 600; margin: 0 0 0.5rem; letter-spacing: -0.02em; color: #111827; }
    .hero .tagline { font-size: 1rem; color: #6b7280; max-width: 32rem; margin: 0 auto 0.5rem; }
    .hero .autonomous { font-size: 0.875rem; color: #374151; margin-bottom: 1.25rem; }
    .cta {
      display: inline-block;
      background: #111827;
      color: #fff;
      padding: 0.6rem 1.2rem;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 500;
      font-size: 0.875rem;
    }
    .cta:hover { background: #374151; }
    .section { margin-top: 2rem; }
    .section-title { font-size: 1rem; font-weight: 600; color: #111827; margin: 0 0 1rem; }
    .data-section {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 1.5rem;
    }
    .data-cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 1rem; margin-bottom: 0.75rem; }
    .data-card {
      background: #fafbfc;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      padding: 1rem;
      text-align: center;
    }
    .data-card .num { font-size: 1.5rem; font-weight: 600; color: #111827; display: block; }
    .data-card .label { font-size: 0.75rem; color: #6b7280; margin-top: 0.25rem; }
    .data-meta { font-size: 0.8rem; color: #9ca3af; margin-top: 0.5rem; }
    .data-section .msg { color: #6b7280; font-size: 0.875rem; }
    .how-section { margin-top: 2rem; }
    .how-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 0.75rem; }
    .how-item {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      padding: 0.875rem;
      font-size: 0.8125rem;
      color: #4b5563;
      border-left: 3px solid #2563eb;
    }
    .how-item strong { color: #111827; }
    .memory-section { margin-top: 2rem; }
    .memory-toggle {
      display: inline-block;
      background: #fff;
      color: #2563eb;
      border: 1px solid #2563eb;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-weight: 500;
      font-size: 0.875rem;
      cursor: pointer;
    }
    .memory-toggle:hover { background: #eff6ff; }
    .memory-panel {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 1.25rem;
      margin-top: 0.75rem;
      max-height: 70vh;
      overflow-y: auto;
    }
    .memory-panel .loading, .memory-panel .error { color: #6b7280; font-size: 0.875rem; }
    .memory-group { margin-bottom: 1rem; }
    .memory-group-title { font-size: 0.8125rem; font-weight: 600; color: #374151; margin-bottom: 0.5rem; }
    .memory-list { list-style: none; margin: 0; padding: 0; }
    .memory-list li { margin: 0.35rem 0; font-size: 0.875rem; }
    .memory-list a { color: #2563eb; text-decoration: none; }
    .memory-list a:hover { text-decoration: underline; }
    .memory-list .condition { font-size: 0.75rem; color: #6b7280; margin-top: 0.15rem; }
    .foot {
      margin-top: 2.5rem;
      padding-top: 1rem;
      border-top: 1px solid #e5e7eb;
      text-align: center;
      font-size: 0.8125rem;
      color: #6b7280;
    }
    .foot a { color: #2563eb; text-decoration: none; }
    .foot a:hover { text-decoration: underline; }
    .security-note { font-size: 0.75rem; color: #059669; margin-top: 0.5rem; }
  </style>
</head>
<body>
  <div class="page">
    <header class="top-bar">
      <span class="logo">Animal Research Network</span>
      <span class="badge">Secure · Read-only</span>
    </header>

    <section class="hero">
      <h1>Animal Research Network</h1>
      <p class="tagline">Surveillance, literature, clinical, and vet practice resources for animal health. Collected and updated by autonomous agents.</p>
      <p class="autonomous">Agents run on a schedule: ingest, analyze, push. No credentials or PII in this interface.</p>
      <a href="https://github.com/burrows3/AnimalMind" class="cta" rel="noopener noreferrer">View source</a>
    </section>

    <section class="data-section section" aria-labelledby="data-heading">
      <h2 id="data-heading" class="section-title">Live data (from autonomous ingest)</h2>
      <div id="data-cards" class="data-cards">
        <span class="msg">Loading…</span>
      </div>
      <p id="data-meta" class="data-meta"></p>
    </section>

    <section class="how-section section" aria-labelledby="how-heading">
      <h2 id="how-heading" class="section-title">What the agents track</h2>
      <div class="how-grid">
        <div class="how-item"><strong>Surveillance</strong> — CDC travel notices</div>
        <div class="how-item"><strong>Literature</strong> — PubMed</div>
        <div class="how-item"><strong>Cancer</strong> — Veterinary oncology</div>
        <div class="how-item"><strong>Case data</strong> — Veterinary case reports</div>
        <div class="how-item"><strong>Clinical</strong> — Practice, small animal, equine</div>
        <div class="how-item"><strong>Imaging</strong> — TCIA, radiographs</div>
        <div class="how-item"><strong>Vet practice</strong> — AAHA, AVMA, VIN, Merck</div>
      </div>
    </section>

    <section class="memory-section section" aria-labelledby="memory-heading">
      <h2 id="memory-heading" class="section-title">Browse data (agent memory)</h2>
      <p style="font-size:0.875rem; color:#6b7280; margin-bottom:0.75rem;">Latest items from autonomous ingest. Links open the source (CDC, PubMed, etc.).</p>
      <button type="button" class="memory-toggle" id="memory-toggle" aria-expanded="false" aria-controls="memory-panel">Show data</button>
      <div id="memory-panel" class="memory-panel" hidden aria-live="polite"></div>
    </section>

    <p class="foot">Research engine for veterinarians and partners. Data from public sources only. <span class="security-note">No credentials, API keys, or PII are exposed in this UI.</span></p>
  </div>
  <script id="data-summary-inline">window.__DATA_SUMMARY__ = {"lastUpdated":null,"counts":{"surveillance":0,"literature":0,"cancer":0,"case_data":0,"clinical":0,"imaging":0,"vet_practice":0}};</script>
  <script>
    (function () {
      var labels = { surveillance: 'Surveillance', literature: 'Literature', cancer: 'Cancer', case_data: 'Case reports', clinical: 'Clinical', imaging: 'Imaging', vet_practice: 'Vet practice' };
      var order = ['surveillance', 'literature', 'cancer', 'case_data', 'clinical', 'imaging', 'vet_practice'];

      function render(data) {
        var container = document.getElementById('data-cards');
        var metaEl = document.getElementById('data-meta');
        if (!data || !data.counts) {
          container.innerHTML = '<span class="msg">Data will appear after the next autonomous ingest and push.</span>';
          return;
        }
        container.innerHTML = order.map(function (key) {
          var count = data.counts[key] != null ? data.counts[key] : 0;
          var label = labels[key] || key;
          return '<div class="data-card"><span class="num">' + count + '</span><span class="label">' + label + '</span></div>';
        }).join('');
        if (data.lastUpdated) {
          var d = new Date(data.lastUpdated);
          metaEl.textContent = 'Last updated: ' + d.toLocaleString();
        }
      }

      if (window.__DATA_SUMMARY__) {
        render(window.__DATA_SUMMARY__);
        return;
      }

      var url = new URL('data-summary.json', document.location.href).href;
      fetch(url, { cache: 'no-store' })
        .then(function (r) { return r.ok ? r.json() : null; })
        .then(function (data) { render(data); })
        .catch(function () { render(null); });
    })();

    (function () {
      function safeHref(url) {
        if (!url || typeof url !== 'string') return '#';
        var u = (url + '').trim();
        if (u.indexOf('http://') === 0 || u.indexOf('https://') === 0) return u;
        return '#';
      }
      function escapeHtml(s) {
        if (!s) return '';
        var d = document.createElement('div');
        d.textContent = s;
        return d.innerHTML;
      }

      var btn = document.getElementById('memory-toggle');
      var panel = document.getElementById('memory-panel');
      var labels = { surveillance: 'Surveillance', literature: 'Literature', cancer: 'Cancer', case_data: 'Case reports', clinical: 'Clinical', imaging: 'Imaging', vet_practice: 'Vet practice' };
      var order = ['surveillance', 'literature', 'cancer', 'case_data', 'clinical', 'imaging', 'vet_practice'];

      function groupByType(rows) {
        var by = {};
        rows.forEach(function (r) {
          if (!by[r.data_type]) by[r.data_type] = [];
          by[r.data_type].push(r);
        });
        return by;
      }

      function renderMemory(data) {
        if (!data || !Array.isArray(data) || data.length === 0) {
          panel.innerHTML = '<p class="loading">No data yet. Run ingest and push.</p>';
          return;
        }
        var by = groupByType(data);
        panel.innerHTML = order.map(function (type) {
          var items = by[type] || [];
          if (items.length === 0) return '';
          var label = labels[type] || type;
          var list = items.map(function (item) {
            var title = escapeHtml(item.title || 'Untitled');
            var condition = item.condition_or_topic ? escapeHtml(item.condition_or_topic) : '';
            var href = safeHref(item.url);
            var link = href !== '#' ? '<a href="' + escapeHtml(href) + '" target="_blank" rel="noopener noreferrer">' + title + '</a>' : '<span>' + title + '</span>';
            var condHtml = condition ? '<div class="condition">' + condition + '</div>' : '';
            return '<li>' + link + condHtml + '</li>';
          }).join('');
          return '<div class="memory-group"><div class="memory-group-title">' + label + ' (' + items.length + ')</div><ul class="memory-list">' + list + '</ul></div>';
        }).join('');
      }

      btn.addEventListener('click', function () {
        if (panel.hidden) {
          panel.hidden = false;
          btn.textContent = 'Hide data';
          if (!panel.innerHTML || panel.querySelector('.loading') || panel.querySelector('.error')) {
            panel.innerHTML = '<p class="loading">Loading…</p>';
            var url = new URL('data/ingested.json', document.location.href).href;
            fetch(url, { cache: 'no-store' })
              .then(function (r) { return r.ok ? r.json() : null; })
              .then(function (data) { renderMemory(data); })
              .catch(function () {
                panel.innerHTML = '<p class="error">Could not load data. Try again after the next ingest and push.</p>';
              });
          }
        } else {
          panel.hidden = true;
          btn.textContent = 'Show data';
        }
      });
    })();
  </script>
</body>
</html>
